version: "3.8"

services:

    Nsqldb:
        image: postgres:latest
        container_name: "Npgsql_Db"
        ports:
          - '5432:5432'
        restart: always
        networks:
          agri.network:
            ipv4_address: 10.38.0.13
        environment:
          - POSTGRES_USER=farmer
          - POSTGRES_PASSWORD=@o123456
        

    pgadmin: 
        image: dpage/pgadmin4
        container_name: pgadmin
        environment:
          - PGADMIN_DEFAULT_EMAIL=admin@system.vn
          - PGADMIN_DEFAULT_PASSWORD=admin1234
        restart: always
        ports:
          - '5050:80'
        networks:
          agri.network:
            ipv4_address: 10.38.0.14

    rabbitmq:
        image: rabbitmq:3-management
        container_name: 'Farm-RBMsgBus'
        ports:
            - 5672:5672
            - 15672:15672
        
        networks:
            agri.network:
                ipv4_address: 10.38.0.12
        environment:
            - RABBITMQ_DEFAULT_USER=farmer
            - RABBITMQ_DEFAULT_PASS=farmer

    gateway.ocelot:
        build:
          context: .
          dockerfile: src/Gateways/OcelotGateway/Dockerfile
        ports:
          - '80:80'
        environment:
            - ASPNETCORE_ENVIRONMENT=Staging
            - ASPNETCORE_URLS=http://+:80
        ports:
            - 80:80
        networks:
          agri.network:
            ipv4_address: 10.38.0.2

    service.registration:
        build:
          context: .
          dockerfile: src/Services/Service.FarmRegistration/Dockerfile
        environment:
            - ASPNETCORE_ENVIRONMENT=Staging
            - ASPNETCORE_URLS=http://+:80
        networks:
          agri.network:
            ipv4_address: 10.38.0.3
        

          
    service.farmsite:
        build:
          context: .
          dockerfile: src/Services/Service.FarmSite/Dockerfile
        environment:
            - ASPNETCORE_ENVIRONMENT=Staging
            - ASPNETCORE_URLS=http://+:80
        networks:
          agri.network:
            ipv4_address: 10.38.0.4
        

          
    service.identity:
        build:
          context: .
          dockerfile: src/Services/Service.Identity/Dockerfile
        environment:
            - ASPNETCORE_ENVIRONMENT=Staging
            - ASPNETCORE_URLS=http://+:80
        networks:
          agri.network:
            ipv4_address: 10.38.0.5
        

networks:
  agri.network:
    driver: bridge
    ipam:
      config:
        - subnet: 10.38.0.0/24
